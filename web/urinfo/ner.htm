<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    輿情分析
    <small>每日各大新聞網統計</small>
  </h1>
  <ol class="breadcrumb">
    <!-- TODO -->
    <li><a href="#"><i class="fa fa-dashboard"></i>首頁</a></li>
    <li class="active">輿情分析</li>
  </ol>
</section>

<!-- Main content -->
<section class="content">
  <!-- Small boxes (Stat box) -->
  <div class="row">
    <div class="col-lg-3 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-aqua">
        <div class="inner">
          <h3>流感</h3>

          <p>599則</p>
        </div>
        <!-- <div class="icon">
          <i class="ion ion-bag"></i>
        </div> -->
        <a href="#" class="small-box-footer">更多資訊 <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-green">
        <div class="inner">
          <h3>新冠肺炎</h3>

          <p>214則</p>
        </div>
        <!-- <div class="icon">
          <i class="ion ion-stats-bars"></i>
        </div> -->
        <a href="#" class="small-box-footer">更多資訊 <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-yellow">
        <div class="inner">
          <h3>戰爭</h3>

          <p>84則</p>
        </div>
        <!-- <div class="icon">
          <i class="ion ion-person-add"></i>
        </div> -->
        <a href="#" class="small-box-footer">更多資訊 <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-red">
        <div class="inner">
          <h3>爆炸</h3>

          <p>47則</p>
        </div>
        <!-- <div class="icon">
          <i class="ion ion-pie-graph"></i>
        </div> -->
        <a href="#" class="small-box-footer">更多資訊 <i class="fa fa-arrow-circle-right"></i></a>
      </div>
    </div>
    <!-- ./col -->
  </div>
  <!-- /.row -->
  <!-- Main row -->
  <div class="row">
    <div class="col-md-6">
      <!-- BAR CHART -->
      <div class="box box-success">
        <div class="box-header with-border">
          <h3 class="box-title">資料來源</h3>

          <div class="box-tools pull-right">
            <!-- <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button> -->
          </div>
        </div>
        <div class="box-body">
          <div class="chart">
            <canvas id="barChart" style="height:400px"></canvas>
          </div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
    <div class="col-md-6">
      <!-- LINE CHART -->
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">關鍵字聲量趨勢</h3>

          <div class="box-tools pull-right">
            <!-- <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button> -->
          </div>
        </div>
        <div class="box-body">
          <div class="chart">
            <canvas id="lineChart" style="height:400px"></canvas>
          </div>
        </div>
        <!-- /.box-body -->
      </div>
      <!-- /.box -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.row (main row) -->

  <!-- Main row -->
  <div class="row">
    <div class="col-md-6">
      <!-- BAR STACKED CHART -->
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">關鍵字好感度分析</h3>

          <div class="box-tools pull-right">
            <!-- <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button> -->
          </div>
        </div>
        <div class="box-body">
          <div class="chart">
            <canvas id="barStackedChart" style="height:400px"></canvas>
          </div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
    <div class="col-md-6">
      <!-- PIE CHART -->
      <div class="box box-warning">
        <div class="box-header with-border">
          <h3 class="box-title">關鍵字占比</h3>

          <div class="box-tools pull-right">
            <!-- <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button> -->
          </div>
        </div>
        <div class="box-body">
          <div class="chart">
            <canvas id="pieChart" style="height:400px"></canvas>
          </div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
    <!-- /.box -->
  </div>
  <!-- /.row (main row) -->
  <!-- 
  <div class="row">
    <div class="col-md-12">
      <div class="box box-danger">
        <div class="box-header with-border">
          <h3 class="box-title">文字雲</h3>
        </div>
        <div class="box-body">
          <div class="row">
            <div class="col-md-12">
              <div id="wordCloud" class="text-center"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <!-- <div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">前十大網路聲量-地方首長</h3>
        </div>
        <div class="box-body">
          <table id="example2" class="table table-bordered table-hover">
            <thead>
              <tr>
                <th></th>
                <th></th>
                <th>地方首長</th>
                <th>好評影響力</th>
                <th>網路聲量(篇)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><img src="dist/img/number/one.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_265.jpg" alt="" width="40" height="40"></td>
                <td>柯文哲</td>
                <td>6.3</td>
                <td>600,861</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/two.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_259.jpg" alt="" width="40" height="40"></td>
                <td>陳其邁</td>
                <td>6.6</td>
                <td>298,902</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/three.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_1222.jpg" alt="" width="40" height="40"></td>
                <td>黃偉哲</td>
                <td>6.57</td>
                <td>185,079</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/four.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_285.jpg" alt="" width="40" height="40"></td>
                <td>侯友宜</td>
                <td>6.78</td>
                <td>115,515</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/five.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_268.jpg" alt="" width="40" height="40"></td>
                <td>鄭文燦</td>
                <td>6.7</td>
                <td>56,568</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/six.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_1483.jpg" alt="" width="40" height="40"></td>
                <td>盧秀燕</td>
                <td>6.75</td>
                <td>42,920</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/seven.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_1538.jpg" alt="" width="40" height="40"></td>
                <td>潘孟安</td>
                <td>6.41</td>
                <td>20,119</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/eight.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_1229.jpg" alt="" width="40" height="40"></td>
                <td>林右昌</td>
                <td>6.41</td>
                <td>17,189</td>
              </tr>
              <tr>
                <td><img src="dist/img/number/nine.png" alt="" width="40" height="40"></td>
                <td><img src="dist/img/local-head/Keypoitem_1428.jpg" alt="" width="40" height="40"></td>
                <td>王惠美</td>
                <td>6.52</td>
                <td>12,012</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div> -->
  <!-- /.row (main row) -->
</section>
<!-- /.content -->

<script src="bower_components/chart.js/Chart.js"></script>
<script src="bower_components/d3.js/d3.min.js"></script>
<script src="bower_components/d3.js/cloud.js"></script>

<script>
  var ajaxUrlPort = '10.55.52.98:85'; //HPC idap 
  //-------------
  //- BAR CHART -
  //-------------
  var barChartData = {
    // labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    datasets: [{
      label: '',
      backgroundColor: '#00a65a',
      strokeColor: '#00a65a',
      pointColor: '#00a65a',
      pointStrokeColor: '#c1c7d1',
      pointHighlightFill: '#fff',
      pointHighlightStroke: 'rgba(220,220,220,1)',
      // data: [65, 59, 80, 81, 56, 55, 40]
    }, ]
  }

  var barChartCanvas = document.getElementById('barChart').getContext("2d");
  var barChartOptions = {
    legend: {
      display: false
    },
    title: {
      display: true,
      text: '各大新聞每日新聞數'
    },
    responsive: true,
    scales: {
      xAxes: [{
        display: true,
        scaleLabel: {
          display: true,
          labelString: '新聞網站'
        }
      }],
      yAxes: [{
        display: true,
        scaleLabel: {
          display: true,
          labelString: '新聞篇數'
        }
      }]
    }
  }

  var item = {
    //url: `http://10.55.52.98:8202/api/getNewsNumByWeb`,
    url: "http://" + ajaxUrlPort + "/getNewsNumByWeb",
    type: "GET",
    headers: {
      "X-Requested-With": "XMLHttpRequest",
      // Authorization: `Bearer ${localStorage.getItem("token")}`,
    },
    contentType: false, //required
    processData: false, // required
    beforeSend: function () {},
  };

  $.ajax(item)
    .done(function (res) {
      barChartData.labels = res.map(x => {
        return x.web;
      });

      barChartData.datasets[0].data = res.map(x => {
        return x.number;
      });

      barChartOptions.datasetFill = false
      var barChart = new Chart(barChartCanvas, {
        type: 'bar',
        data: barChartData,
        options: barChartOptions
      })
    })
    .fail(function (res) {
      result = JSON.parse(res.responseText);
      console.log(result);
    });

  //----------------
  //- Related News -
  //----------------

  var tableItem = {
    //url: `http://10.55.52.98:8202/api/getNewsNumByWeb`,
    url: "http://" + ajaxUrlPort + "/getNewsNumByWeb",
    type: "GET",
    headers: {
      "X-Requested-With": "XMLHttpRequest",
      // Authorization: `Bearer ${localStorage.getItem("token")}`,
    },
    contentType: false, //required
    processData: false, // required
    beforeSend: function () {},
  };

  $.ajax(tableItem)
    .done(function (res) {})
    .fail(function (res) {
      result = JSON.parse(res.responseText);
      console.log(result);
    });

  $(function () {
    //-------------
    //- LINE CHART -
    //-------------
    var lineChartData = {
      labels: ['01/20', '02/20', '03/20', '04/20', '05/20', '06/20', '07/20', '08/20', '09/20', '10/20', '11/20'],
      datasets: [{
        label: '拜登',
        fill: false,
        backgroundColor: "rgb(59, 175, 218)",
        borderColor: "rgb(59, 175, 218)",
        data: [43.30, 50.20, 49.80, 50.40, 47.40, 49.00, 49.70, 49.40, 49.00, 50.10, 51.10]
      }, {
        label: '川普',
        fill: false,
        backgroundColor: "rgb(233, 87, 63)",
        borderColor: "rgb(233, 87, 63)",
        data: [49.00, 44.80, 44.40, 44.30, 42.10, 42.20, 40.30, 42.00, 43.00, 42.90, 43.90]
      }]
    }

    var lineChartCanvas = document.getElementById('lineChart').getContext("2d");
    var lineChartOptions = {
      responsive: true,
      title: {
        display: true,
        text: '關鍵字聲量趨勢'
      },
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        xAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: '月份'
          }
        }],
        yAxes: [{
          display: true,
          scaleLabel: {
            display: true,
            labelString: '民調百分比(%)'
          }
        }]
      }
    }

    var lineChart = new Chart(lineChartCanvas, {
      type: 'line',
      data: lineChartData,
      options: lineChartOptions
    })


    var ctx = document.getElementById("barStackedChart").getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ["HAHOW好學校", "udemy", "pressplay", "Khan Academy", "Coursera", "PaGamO"],
        datasets: [{
          label: '正面',
          backgroundColor: "#a72126",
          data: [60, 25, 58, 32, 30, 63],
        }, {
          label: '中立',
          backgroundColor: "#666",
          data: [39, 72, 37, 68, 67, 33],
        }, {
          label: '負面',
          backgroundColor: "#23b4e0",
          data: [1, 3, 5, 0, 3, 4],
        }],
      },
      options: {
        title: {
          display: true,
          text: '關鍵字好感度分析'
        },
        tooltips: {
          displayColors: true,
          callbacks: {
            mode: 'x',
          },
        },
        scales: {
          xAxes: [{
            stacked: true,
            gridLines: {
              display: false,
            },
            scaleLabel: {
              display: true,
              labelString: '線上課程平台'
            }
          }],
          yAxes: [{
            stacked: true,
            ticks: {
              beginAtZero: true,
            },
            type: 'linear',
            scaleLabel: {
              display: true,
              labelString: '好感度(%)'
            }
          }]
        },
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          position: 'bottom'
        },
      }
    });

    var randomScalingFactor = function () {
      return Math.round(Math.random() * 100);
    };

    var config = {
      type: 'doughnut',
      data: {
        datasets: [{
          data: [
            31.9, 22.3, 13.1, 9.2, 5.3, 18.2
          ],
          backgroundColor: [
            "#064984", "#4188B3", "#74A8C7", "#CDF2F9", "#E3F7FB",
          ],
          label: 'Dataset 1'
        }],
        labels: [
          '流感',
          '新冠肺炎',
          '戰爭',
          '爆炸',
          '野火',
          '其他'
        ]
      },
      options: {
        responsive: true,
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: '關鍵字占比'
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      }
    };

    var ctx = document.getElementById('pieChart').getContext('2d');
    window.myDoughnut = new Chart(ctx, config);
  })



  // var text_string = "Of course that’s your contention. You’re a first year grad student. You just got finished readin’ \
  // some Marxian historian, Pete Garrison probably.You’ re gonna be convinced of that’ til next month when you get to \
  // James Lemon and then you’ re gonna be talkin’ about how the economies of Virginia and Pennsylvania were \
  // entrepreneurial and capitalist way back in 1740. That’ s gonna last until next year.You’ re gonna be in here \
  // regurgitating Gordon Wood, talkin’ about, you know, the Pre - Revolutionary utopia and the capital - \
  //   forming effects of \
  //   military mobilization…‘ Wood drastically underestimates the impact of social distinctions predicated upon wealth, \
  //   especially inherited wealth.’You got that from Vickers, Work in Essex County, page 98, right ? Yeah, I read that, \
  //   too.Were you gonna plagiarize the whole thing \
  // for us ? Do you have any thoughts of your own on this matter ? Or do \
  //     you, is that your thing ? You come into a bar.You read some obscure passage and then pretend, \
  //     you pawn it off as your \
  //   own, as your own idea just to impress some girls and embarrass my friend ? See, \
  //   the sad thing about a guy like you is in 50 years, \
  //   you’ re gonna start doin’ some thinkin’ on your own and you’ re gonna come up with the fact that there are \
  // two certainties in life.One: don’ t do that.And two: you dropped a hundred and fifty grand on a fuckin’ education \
  //   you coulda got \
  // for a dollar fifty in late charges at the public library. \
  // ";



  // function drawWordCloud(text_string) {
  //   var common =
  //     "poop,i,me,my,myself,we,us,our,ours,ourselves,you,your,yours,yourself,yourselves,he,him,his,himself,she,her,hers,herself,it,its,itself,they,them,their,theirs,themselves,what,which,who,whom,whose,this,that,these,those,am,is,are,was,were,be,been,being,have,has,had,having,do,does,did,doing,will,would,should,can,could,ought,i'm,you're,he's,she's,it's,we're,they're,i've,you've,we've,they've,i'd,you'd,he'd,she'd,we'd,they'd,i'll,you'll,he'll,she'll,we'll,they'll,isn't,aren't,wasn't,weren't,hasn't,haven't,hadn't,doesn't,don't,didn't,won't,wouldn't,shan't,shouldn't,can't,cannot,couldn't,mustn't,let's,that's,who's,what's,here's,there's,when's,where's,why's,how's,a,an,the,and,but,if,or,because,as,until,while,of,at,by,for,with,about,against,between,into,through,during,before,after,above,below,to,from,up,upon,down,in,out,on,off,over,under,again,further,then,once,here,there,when,where,why,how,all,any,both,each,few,more,most,other,some,such,no,nor,not,only,own,same,so,than,too,very,say,says,said,shall";

  //   var word_count = {};

  //   var words = text_string.split(/[ '\-\(\)\*":;\[\]|{},.!?]+/);
  //   if (words.length == 1) {
  //     word_count[words[0]] = 1;
  //   } else {
  //     words.forEach(function (word) {
  //       var word = word.toLowerCase();
  //       if (word != "" && common.indexOf(word) == -1 && word.length > 1) {
  //         if (word_count[word]) {
  //           word_count[word]++;
  //         } else {
  //           word_count[word] = 1;
  //         }
  //       }
  //     })
  //   }

  //   var svg_location = "#wordCloud";
  //   var width = 1200;
  //   var height = 400;

  //   var fill = d3.scale.category20();

  //   var word_entries = d3.entries(word_count);

  //   var xScale = d3.scale.linear()
  //     .domain([0, d3.max(word_entries, function (d) {
  //       return d.value;
  //     })])
  //     .range([10, 100]);

  //   d3.layout.cloud().size([width, height])
  //     .timeInterval(20)
  //     .words(word_entries)
  //     .fontSize(function (d) {
  //       return xScale(+d.value);
  //     })
  //     .text(function (d) {
  //       return d.key;
  //     })
  //     .rotate(function () {
  //       return ~~(Math.random() * 2) * 90;
  //     })
  //     .font("Impact")
  //     .on("end", draw)
  //     .start();

  //   function draw(words) {
  //     d3.select(svg_location).append("svg")
  //       .attr("width", width)
  //       .attr("height", height)
  //       .append("g")
  //       .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")
  //       .selectAll("text")
  //       .data(words)
  //       .enter().append("text")
  //       .style("font-size", function (d) {
  //         return xScale(d.value) + "px";
  //       })
  //       .style("font-family", "Impact")
  //       .style("fill", function (d, i) {
  //         return fill(i);
  //       })
  //       .attr("text-anchor", "middle")
  //       .attr("transform", function (d) {
  //         return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
  //       })
  //       .text(function (d) {
  //         return d.key;
  //       });
  //   }

  //   d3.layout.cloud().stop();
  // }
  // drawWordCloud(text_string);
</script>